<html lang="en">
<head>
    <title>Gallery</title>
    <meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
    <link href="css/main.css" rel="stylesheet" type="text/css">
    <link href="css/animations.css" rel="stylesheet" type="text/css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body>
<div class="container">


    <div class="main-content">
        <div class="input-date">
            <div>
                <input id="date" type="date"/>
            </div>
        </div>
        <div class="welcome">
            <div class="message-welcome" id="welcome-message" style="display: none">
                <p>HAPPY 29TH MONTHSARY BIBII!!! :)</p>

            </div>
            <div class="loader" id="loader-class" style="display: none"></div>
        </div>
        <div class="card-container" id="card-container" style="display: none;">
            <div class="card">
                <div class="card-modal image-display ">
                    <img alt="Closed Mail Icon" class="card-image" id="mail-closed" src="icons/closed-mail.png">
                    <img alt="Open Mail Icon" class="card-image" id="mail-open" src="icons/open-mail.png">
                </div>
                <div class="card-back" style="padding:10px;">
                    <p style="text-align: center;text-transform: uppercase;">Happy 29th Monthsary </p>
                    <span id="message-here"></span>
                </div>
            </div>

            <div class="card">
                <div class="card-modal ">
                    <p>FOR YOU BIBII</p>
                </div>
                <div class="card-back image-display">
                    <img alt="Sunflower" id="flowers" src="icons/sun-flower.png">
                </div>
            </div>
        </div>

    </div>

</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script type="text/javascript" >

    const guest_date = document.getElementById("date");
    const loader = document.getElementById("loader-class");
    const cards = document.getElementById("card-container");
    let welcomeMessage = document.getElementById("welcome-message");

    function startTimer() {
        let count = 0;
        let timer = setInterval(() => {
            ++count;
            if (count === 180) {
                localStorage.removeItem("hasAlreadyInputted");
                clearInterval(timer)
            }
        }, 1000)
    }
    async function getMessageContent(){

         await fetch("message_content.txt").then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.text();
        })
        .then(data => {
            document.getElementById("message-here").innerText = data;
        })

    }


    if (localStorage.getItem('hasAlreadyInputted')) {
        guest_date.style = "display:none";
        loader.style = "display:none";
        welcomeMessage.style = "display:none";
        cards.style = "display:flex";
       setTimeout(async () => {
           document.getElementById("message-here").innerHTML = ` <div class="loader" id="loader-class"></div>`;
           await getMessageContent();
       },2000)
    }

    guest_date.addEventListener('change',async function (e) {

        if (![null, undefined, ' '].includes(e.target.value)) {
            let formatted_date = new Date(e.target.value);
            const year = formatted_date.getFullYear();
            const month = formatted_date.getMonth() + 1;
            const day = formatted_date.getDate();

            if (
                year == "2023" &&
                month == "7" &&
                day == "03"
            ) {
                if (!localStorage.getItem('hasAlreadyInputted')) {
                    localStorage.setItem("hasAlreadyInputted", "1");
                    startTimer();
                }
                this.style = "display:none";
                welcomeMessage.style = "display:block";
                setTimeout(() => {
                    loader.style = "display:block";
                }, 1500)
                setTimeout(() => {
                    loader.style = "display:none";
                    welcomeMessage.style = "display:none";
                }, 5000);
                setTimeout(async () => {
                    await getMessageContent();
                    cards.style = "display:flex";
                }, 5500)
            }
        }

    })
</script>
</body>
</html>